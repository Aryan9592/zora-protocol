@startuml
actor Collector
entity PremintCollectPage 
boundary SignatureAPI
entity SignatureDB
entity PreminterContract
entity 1155FactoryContract
entity 1155Contract

Collector -> PremintCollectPage: Open, param is \nsignature hash
Activate PremintCollectPage
PremintCollectPage -> SignatureAPI: Fetch by signature hash 
SignatureAPI -> SignatureDB: Fetch signature by hash\nthat isn't deleted
SignatureDB --> SignatureAPI: contract + token creation params\n+ signature
SignatureAPI --> PremintCollectPage: contract + token creation params\n+ signature
PremintCollectPage -> PreminterContract: Check if signature has been used
PreminterContract --> PremintCollectPage: Signature has been used or not

Group signature has been used

    PremintCollectPage -> Collector: Redirect to \nstandard collect page

end

Collector -> PremintCollectPage: mint
PremintCollectPage -> Collector: Submit transaction
deactivate PremintCollectPage
Collector -> PreminterContract: Submit premint transaction containing \nsignature, contract creation & token creation params
activate PreminterContract
PreminterContract -> PreminterContract: record signature used;\nrevert if already used

Group contract doesnt exist
  
    PreminterContract -> 1155FactoryContract: create contract
    1155FactoryContract -> 1155Contract: create
    activate 1155Contract

end

PreminterContract -> 1155Contract: create new token
PreminterContract -> 1155Contract: set new token sale parameters
PreminterContract -> 1155Contract: mint tokens to collector

deactivate PreminterContract
1155Contract --> Collector: Minted tokens
deactivate 1155Contract

@enduml